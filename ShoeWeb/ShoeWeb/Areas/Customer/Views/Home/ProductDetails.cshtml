
@{
    ViewBag.Title = "ProductDetails";
    Layout = "~/Areas/Customer/Views/Shared/_Layout.cshtml";
}

@model ShoeWeb.Areas.Customer.CustomerVM.DetailProductVM

@if (Model.Product == null)
{
    <h2>Chưa chọn sản phẩm nào! Hãy <a href="@Url.Action("Product","Home")">chọn môt sản phẩm</a></h2>
}
else
{
    <div class="small-container single-product">
        <div class="row">
            <!-- Hình ảnh sản phẩm chính -->
            <div class="col-2">
                <img src="@Model.Product.image" width="100%" id="productImg" alt="@Model.Product.productName">

                <!-- Hình ảnh nhỏ bên dưới (nếu cần) -->
                <!--<div class="small-img-row">
                   <div class="small-img-col">
                       <img src="@Model.Product.image" width="100%" class="small-img">
                   </div>
                </div>-->
            </div>

            <!-- Chi tiết sản phẩm -->
            <div class="col-2">
                <p>Home / Shoes</p>
                <h1>@Model.Product.productName</h1>
                <h4>@Model.Product.price.ToString("#,##0.##")đ</h4>
                <select id="sizeSelect">
                    <option>Chọn Kích Cỡ</option>
                    @foreach (var item in Model.sizes)
                    {
                        <option value="@item.sizeId">@item.numberSize</option>
                    }
                </select>
                <input type="number" id="quantityInput" value="1" min="1" oninput="updateQuantity()">
                <button onclick="addToCart(@Model.Product.productId)" type="button" class="btn">Thêm vào giỏ hàng</button>
                <h3>Chi tiết sản phẩm <i class="fa fa-indent"></i></h3>
                <p>@Model.Product.productDescription</p>
            </div>
        </div>
    </div>

    <div class="small-container">
        <!-- Tiêu đề sản phẩm liên quan -->
        <div class="row row-2">
            <h2>Sản phẩm liên quan</h2>
            <a href="@Url.Action("Product", "Home")"><p>Xem thêm</p></a>
        </div>

        <!-- Sản phẩm liên quan -->
        <div class="row" style="justify-content: flex-start;">
            @foreach (var relatedProduct in Model.products)
            {
                <div class="col-4">
                    <a href="@Url.Action("ProductDetails", "Home", new { productId = relatedProduct.productId })">
                        <img src="@relatedProduct.image" alt="@relatedProduct.productName">
                    </a>
                    <a href="@Url.Action("ProductDetails", "Home", new { productId = relatedProduct.productId })">
                        <h4>@relatedProduct.productName</h4>
                    </a>
                 
                    <p>@relatedProduct.price.ToString("#,##0.##")đ</p>
                </div>
            }
        </div>
    </div>
}

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
   function addToCart(productId) {
        const sizeId = document.getElementById('sizeSelect').value;
        const quantity = document.getElementById('quantityInput').value;
       console.log("ProductId: " + productId);
       console.log("SizeId: " + sizeId);
       console.log("Quantity: " + quantity);

        if (!sizeId) {
            alert("Vui lòng chọn kích cỡ!");
            return;
        }

        if (quantity <= 0) {
            alert("Số lượng phải lớn hơn 0!");
            return;
        }

        $.ajax({
            url: '@Url.Action("AddToCart", "Cart" , new {area = "Customer"})',
            type: 'post',
            data: {
                id: productId,
                sizeId: sizeId,
                quantity: quantity
            },
            success: function (result) {
                if (result.success) {
                    alert("Thêm thành công");
                    window.location.href = '@Url.Action("Index", "Cart")';
                } else {
                    alert("Thêm thất bại! Lỗi: " + result.Message );
                }
            },
            error: function (xhr, status, error) {
                alert("Có lỗi xảy ra!");
            }
    });
}


    // Chuyển đổi ảnh sản phẩm khi nhấn vào hình ảnh nhỏ
    var productImg = document.getElementById("productImg");
    var smallImg = document.getElementsByClassName("small-img");

    for (let i = 0; i < smallImg.length; i++) {
        smallImg[i].onclick = function () {
            productImg.src = smallImg[i].src;
        };
    }



    function updateQuantity() {
        const inputElement = document.getElementById('quantityInput');
        const quantity = inputElement.value;
        document.getElementById('quantityDisplay').textContent = `Số lượng hiện tại: ${quantity}`;
    }

</script>


